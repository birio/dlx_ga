\documentclass{article}

\usepackage{ipprocess}
%\usepackage{lmodern}
\usepackage{longtable}
\usepackage[latin1]{inputenc} 
\usepackage[T1]{fontenc}
\pagestyle{fancy}
\usepackage{libertine}

%\usepackage[author={João Carlos Nunes Bittencourt}]{pdfcomment}

\sloppy

\title{32-bit uDLX Core Processor}

\graphicspath{{./pictures/}} % Diretório padrão de figuras.
\makeindex
\begin{document}
  \capa{1.0}{abril}{2014}{32-bit uDLX Core Processor}{Architecture Specification}{Universidade Federal da Bahia}
  \newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% GNU LGPL Licence
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  
\begin{center}
\begin{Large}\textbf{GNU LGPL License}                          \end{Large}
\end{center}
\vspace{2cm}
\fbox{
  \parbox{.7\textwidth}{
    \vspace{0,5cm}
    \begin{scriptsize}
    This file is part of uDLX (micro-DeLuX) soft IP-core.\\

    uDLX is free soft IP-core: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.\\

    uDLX soft core is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with uDLX. If not, see <http://www.gnu.org/licenses/>.
    \end{scriptsize}
    \vspace{0,5cm}
  }
}

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Histórico de Revisões
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \section*{\center Histórico de Revisões}
  \vspace*{1cm}
  \begin{table}[ht] % aqui começa o ambiente tabela
  \centering
  \begin{tabular}[pos]{|m{2cm} | m{7.2cm} | m{3.8cm}|} 
  \hline % este comando coloca uma linha na tabela
  \cellcolor[gray]{0.9}
  \textbf{Date} & \cellcolor[gray]{0.9}\textbf{Description} & \cellcolor[gray]{0.9}\textbf{Author(s)}\\ \hline
  \hline
  \small 04/27/2014 & \small Conception & \small João Carlos Bittencourt \\ \hline
  \small 04/30/2014 & \small Instruction layout description & \small João Carlos Bittencourt \\ \hline
  \end{tabular}
  \label{tab:revisoes}
  \end{table}
  
  \newpage
  
  \tableofcontents
  \newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Concent
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \section{Introduction}
  \subsection{Purpose}
  The main purpose of this document is to define specifications of a uDLX implementation and to provide a full overview of the design. This specifications defines all implementation parameters that composes the general uDLX requirements and specification. This definitions include processor operation modes, instruction set (ISA) and internal registers characteristics. This document also include detailed information of pipeline stages architecture, buses and other supplemental units.
  
  \subsection{Document Outline Description}
  This document is outlined as follow:
	
	\begin{itemize}
	  \item Section : 
	  \item Section : 
	\end{itemize}
		
  \subsection{Acronyms and Abbreviations}
  Along this and other documents part of this project, it will be recurrent the usage of some acronyms and abbreviations. In order to keep track of this elements the Table \ref{tab:definitions} presents a set of abbreviations used and its corresponding meaning.
  
  \FloatBarrier
  \begin{table}[H] % aqui começa o ambiente tabela
    \begin{center}
      \caption{Acronym and descriptions of elements in this document.}
      \label{tab:definitions}

      \begin{tabular}[pos]{|m{2cm} | m{9cm}|} 
	\hline % este comando coloca uma linha na tabela
	\cellcolor[gray]{0.9}\textbf{Acronym} & \cellcolor[gray]{0.9}\textbf{Description} \\ \hline
	RISC & Reduced Instruction Set Computer \\ \hline
	GPR & General Purpose Registers \\ \hline
	FPGA & Field Gate Programmable Array \\ \hline
	GPPU & General Purpose Processing Unit \\ \hline
	SDRAM & Synchronous Dynamic Random Access Memory\\ \hline
	HDL & Hardware Description Language \\ \hline
	RAW & Read After Write \\ \hline
	CPU & Central Processing Unit \\ \hline
	ISA & Instruction Set Architecture \\ \hline
	ALU & Arithmetic and Logic Unit \\ \hline
	PC  & Program Counter \\ \hline
	RFlags & Flags Register \\ \hline
	Const  & Constant \\ \hline
      \end{tabular}
    \end{center}
  \end{table}
  
  \newpage
  \section{Architecture Overview}
  \label{sec:architecture_overview}
  
  \subsection{Block Diagram}
  \begin{figure}[H]
    \centering
    \includegraphics[width=.8\linewidth]{pictures/udlx_block.eps}
  \label{fig:datapath}
  \end{figure}
 
 
  \subsection{Pin/Port Definitions}
  \FloatBarrier
  \begin{table}[H]
    \begin{center}
      \begin{tabular}[pos]{| l | c | c | m{7cm} |} \hline 	
      \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
	 clock 		& 1 	& input 	& CPU core clock  	\\ \hline
	 reset 		& 1	& input		& CPU core reset  	\\ \hline
	 sram\_data\_io 	& 16	& in/out 	& SRAM data \\ \hline
	 sdram\_data\_io 	& 32	& in/out 	& SDRAM data \\ \hline
	 sram\_addr 	& 20	& input 	& SRAM address \\ \hline
	 sram\_we\_n 	& 1	& output 	& SRAM write enable  \\ \hline
	 sram\_oe\_n 	& 1	& output 	& SRAM output enable  \\ \hline
	 sdram\_addr 	& 13	& in/out	& SDRAM address \\ \hline
	 sdram\_we 	& 1	& output 	& SDRAM write enable  \\ \hline
	 sdram\_oe 	& 1	& output 	& SDRAM output enable  \\ \hline
      \end{tabular}
    \end{center}
  \end{table}  
   
  \subsection{Parameters and Configurations}

 \FloatBarrier
  \begin{table}[H]
    \begin{center}
      \begin{tabular}[pos]{| l | l | m{8cm} |} \hline 	
      \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Value}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
	  & &  	\\ \hline
      \end{tabular}
    \end{center}
  \end{table} 
    
  \newpage
  \section{Instructions Layout}
  
  \subsection{ALU}
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/alu_instruction.eps}
  \end{figure} 
  
  \FloatBarrier
  \begin{table}[H]
    \begin{center}
      \begin{tabular}[pos]{| c | l | l | l |} \hline 	
      \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{OP}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Opperation}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Mnemonic}} &
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Flags Update}} \\ \hline
	 0000 & $R_D = R_D + R_F$ 	& add d, f 	& all	 \\ \hline
	 0001 & $R_D = R_D - R_F$ 	& sub d, f 	& all 	\\ \hline
	 0010 & $R_D = R_D * R_F$ 	& mul d, f 	& all	\\ \hline
	 0011 & $R_D = R_D / R_F$ 	& div d, f 	& all	\\ \hline
	 0100 & $R_D = R_D~and~R_F$ 	& and d, f 	& above, equal, error \\ \hline
	 0101 & $R_D = R_D~or~R_F$ 	& or d, f 	& above, equal, error \\ \hline
	 0110 & $R_flags = R_D~cmp~R_F$ 	& cmp d, f 	& above, equal, error \\ \hline
	 0111 & $R_D =~not~R_D $		& not d 	& above, equal, error \\ \hline
      \end{tabular}
    \end{center}
  \end{table} 
  
  \subsection{Immediate}
  
  \textbf{Type I}
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/immediate_type_1.eps}
  \end{figure}  
  
  \hspace{-36px}\textbf{Type II}  
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/immediate_type_2.eps}
  \end{figure}  
  
  \FloatBarrier
  \begin{table}[H]
    \begin{center}
      \begin{tabular}[pos]{| c | l | l |} \hline 	
      \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Type}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Opperation}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Mnemonic}} \\ \hline
	 I 	& $R_D = I_{16}$ 	 & load immediate, d \\ \hline
	 II 	& $R_D = [I_{16} + R_B]$ & load immediate, d, b \\ \hline
	 II 	& $[I_{16} + R_B] = R_D$ & load d, immediate, b \\ \hline
      \end{tabular}
    \end{center}
  \end{table} 
  
  \subsection{Control Transfer}
  The $\mu$DLX core processor has five control transfer instructions encoded using the following three types. The first encoding type is used for unconditional jump and subroutine call. The second one is used for conditional branch, based on ALU flags. The third one reffers to the unconditional jump related to PC by an immediate value offset.

  \hspace{-36px}\textbf{Type I}
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/control_type_1.eps}
  \end{figure}  
  
  \hspace{-36px}\textbf{Type II}
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/control_type_2.eps}
  \end{figure}  
  
  \hspace{-36px}\textbf{Type III}
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/control_type_3.eps}
  \end{figure}  
  
  \FloatBarrier
  \begin{table}[H]
    \begin{center}
      \begin{tabular}[pos]{| c | l | l | l |} \hline 	
      \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Type}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{OP}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Opperation}} &
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Mnemonic}} \\ \hline
	 I 	& 00 & Jump Register	& jr r \\ \hline
	 I 	& 01 & Subroutine call  & call r \\ \hline
	 II 	& 10 & Branch flags 	& brfl r, const\\ \hline
	 III 	& 11 & Jump PC 		& jpc destiny\\ \hline	 
      \end{tabular}
    \end{center}
  \end{table}   
  
  \subsection{Memory}
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/alu_instruction.eps}
  \end{figure} 
  
  \FloatBarrier
  \begin{table}[H]
    \begin{center}
      \begin{tabular}[pos]{| c | l | l |} \hline 	
      \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{OP}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Opperation}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Mnemonic}} \\ \hline
	 1000 & $R_D = Mem[R_B]$ 	& load d, b 	 \\ \hline
	 1100 & $Mem[R_B] = R_D$ 	& store b, d 	\\ \hline
      \end{tabular}
    \end{center}
  \end{table}   
  
  \section{Architecture Description}
  
  \subsection{Instruction Fetch}
  \subsubsection{Block Diagram}
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/blocks/if_block.eps}
  \end{figure}    
  
  \subsubsection{Pin/Port Definitions}
  \FloatBarrier
  \begin{table}[H]
    \begin{center}
      \begin{tabular}[pos]{| l | c | c | m{7cm} |} \hline 	
      \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
	 clock 		& 1 	& input 	& CPU core clock  	\\ \hline
	 reset 		& 1	& input		& CPU core reset  	\\ \hline
	 sram\_data\_io 	& 16	& in/out 	& SRAM data \\ \hline
	 branch\_pc 	& 20	& input 	& Branch address PC relative \\ \hline
	 branch\_reg 	& 20	& input 	& Branch address loaded from registers \\ \hline
	 npc 		& 20	& output 	& New program counter value  \\ \hline
	 instruction 	& 32	& output 	& CPU core instruction  \\ \hline
	 sram\_addr 	& 20	& output	& SRAM address \\ \hline
	 sram\_we 	& 1	& output 	& SRAM write enable  \\ \hline
      \end{tabular}
    \end{center}
  \end{table}  
  \subsection{Instruction Decoding}
  \subsubsection{Block Diagram}
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/blocks/id_block.eps}
  \end{figure} 
  
  \subsubsection{Pin/Port Definitions}
  \FloatBarrier
    \begin{center}
      \begin{longtable}[pos]{| l | c | c | m{7cm} |} \hline       	
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endfirsthead
        \hline
        \multicolumn{4}{|l|}%
        {{\bfseries continued from previous page}} \\
        \hline
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endhead

        \hline \multicolumn{4}{|r|}{{continued on next page}} \\ \hline
        \endfoot

        \hline
        \endlastfoot

      	clock 		          & 1 	& input 	& CPU core clock  	\\ \hline
      	reset 		          & 1	& input		& CPU core reset  	\\ \hline
      	instruction\_reg    & 32	& input 	& SRAM data \\ \hline
      	new\_pc 	          & 20	& input 	& Branch address PC relative \\ \hline
      	w\_en 	            & 1	& input 	& Branch address loaded from registers \\ \hline
      	w\_reg\_addr 	      & 4	& input 	& New program counter value  \\ \hline
      	reg\_data 	        & 32	& input 	& CPU core instruction  \\ \hline
      	fwd\_mem\_data 	    & 32	& input	  & SRAM address \\ \hline
      	fwd\_ex\_data 	    & 32	& input 	& SRAM write enable  \\ \hline
      	select\_rd 	        & TBD& output 	& SRAM output enable  \\ \hline
        reg\_w\_en          & TBD& output  &   \\ \hline
        data\_mem\_w\_en    & 1  & output  &   \\ \hline
        alu\_opcode         & 3  & output  &   \\ \hline
        select\_mux\_alu\_a & TBD& output  &   \\ \hline
        select\_mux\_alu\_b & TBD& output  &   \\ \hline
        instruction\_reg    & 32 & output  &   \\ \hline
        constant            & 32 & output  &   \\ \hline
        data\_alu\_a        & 32 & output  &   \\ \hline
        data\_alu\_b        & 32 & output  &   \\ \hline
        new\_pc             & 20 & output  &   \\ 
      \end{longtable}
    \end{center}
  
  \subsection{Stage 3 - Execution}
  
  \subsection{Stage 4 - Memory}
  
  \subsection{Stage 5 - Write Back}
  
  \subsection{Pipeline Register Description}
  
  \subsection{Control Micro-instructions Description}
 
  %\newpage
  %\section{Timing}
    
% \bibliographystyle{ieeetr}
% \bibliography{ipprocess}

\end{document}
