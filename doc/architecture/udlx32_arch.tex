\documentclass{article}

\usepackage{ipprocess}
%\usepackage{lmodern}
\usepackage{longtable}
\usepackage[utf8]{inputenc} 
\usepackage[T1]{fontenc}
\pagestyle{fancy}
\usepackage{libertine}
\usepackage{epstopdf}
\usepackage{rotating} % rotate table 90 degrees
\usepackage{pdflscape} % set ladscape/portrait pdf pages

%\usepackage[author={João Carlos Nunes Bittencourt}]{pdfcomment}

\sloppy

\title{32-bit $\mu$DLX Core Processor}

\graphicspath{{./pictures/}} % DiretTBDrio padrTBDo de figuras.
\makeindex
\begin{document}
  \capa{1.0}{abril}{2014}{32-bit $\mu$DLX Core Processor}{Architecture Specification}{Universidade Federal da Bahia}
  \newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% GNU LGPL Licence
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  
\begin{center}
\begin{Large}\textbf{GNU LGPL License}\end{Large}
\end{center}
\vspace{2cm}
\fbox{
  \parbox{.7\textwidth}{
    \vspace{0,5cm}
    \begin{scriptsize}
    This file is part of uDLX (micro-DeLuX) soft IP-core.\\

    uDLX is free soft IP-core: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.\\

    uDLX soft core is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with uDLX. If not, see <http://www.gnu.org/licenses/>.
    \end{scriptsize}
    \vspace{0,5cm}
  }
}

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Revision History
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \section*{\center Revision History}
  \vspace*{1cm}
  \begin{table}[ht] % aqui comeTBDa o ambiente tabela
  \centering
  \begin{tabular}[pos]{|m{2cm} | m{7.2cm} | m{3.8cm}|} 
  \hline % este comando coloca uma linha na tabela
  \cellcolor[gray]{0.9}
  \textbf{Date} & \cellcolor[gray]{0.9}\textbf{Description} & \cellcolor[gray]{0.9}\textbf{Author(s)}\\ \hline
  \hline
  \small 04/27/2014 & \small Conception & \small João Carlos Bittencourt \\ \hline
  \small 04/30/2014 & \small Instruction layout description & \small João Carlos Bittencourt \\ \hline
  \small 05/09/2014 & 
  \begin{small}
    \begin{itemize}
      \item Text revision;
      \item Update diagrams and instruction layout;
      \item Update instruction fetch I/O definitions;
      \item Missing pictures inclusion;
      \item Include memory access and write back pin/port definitions;
    \end{itemize}
  \end{small} & \small João Carlos Bittencourt \\ \hline
  \small 04/13/2014 & \small Missing pictures & \small João Carlos Bittencourt \\ \hline
  \small 04/15/2014 & \small   \begin{small}
    \begin{itemize}
      \item Fix instruction fetch pin definitions;
      \item Include instruction fetch datapath;
      \item Include pipeline registers definitions;
      \item Fix memory access stage pin/port definitions;
      \item Include write back data path;
    \end{itemize}
  \end{small} & \small João Carlos Bittencourt \\ \hline
  \small 04/15/2014 & \small Add execute block diagram & \small Igo Amauri Luz \\ \hline
  \small 04/16/2014 & \small   \begin{small}
    \begin{itemize}
      \item Add branch prediction signal to ID and IF blocks and pin definitions;
      \item Add table for pin definitions in Execute stage
      \item Add branch prediction signal in pipeline registers definitions;
      \item Include architecture interface figure;
    \end{itemize}
  \end{small} & \small João Carlos Bittencourt \\ \hline 
  \small 04/18/2014 & \small Add execute datapath diagram & \small Igo Amauri Luz \\ \hline
  \small 04/23/2014 & \small Formating; Stakeholders listing & \small João Carlos Bittencourt \\ \hline  
  \end{tabular}
  \end{table}

  \newpage
  
  \tableofcontents
  \newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Concent
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \section{Introduction}
  \subsection{Purpose}
  The main purpose of this document is to define specifications of a uDLX implementation and to provide a full overview of the design. This specifications defines all implementation parameters that composes the general uDLX requirements and specification. This definitions include processor operation modes, instruction set (ISA) and internal registers characteristics. This document also include detailed information of pipeline stages architecture, buses and other supplemental units.

  \subsection{Stakeholders}
  \FloatBarrier
  \begin{table}[H] 
    \begin{center}
      \begin{tabular}[pos]{|m{5cm} | m{8cm}|} 
        \hline % este comando coloca uma linha na tabela
        \cellcolor[gray]{0.9}\textbf{Name} & \cellcolor[gray]{0.9}\textbf{Roles/Responsibilities} \\ \hline
        Igo Amauri Luz & TBD \\ \hline
        João Carlos Bittencourt & TBD \\ \hline  
        Lauê Rami Costa & TBD \\ \hline
        Linton Thiago Esteves & TBD \\ \hline  
        Victor Valente & TBD \\ \hline
      \end{tabular}
    \end{center}
  \end{table}    
  
  \subsection{Document Outline Description}
  This document is outlined as follow:
	
	\begin{itemize}
	  \item Section \color{black}{\ref{sec:architecture_overview}}: This section presents the core processor block diagram, Pin/Port definitions and global parameters and configuration directives.
	  \item Section \color{black}{\ref{sec:instruction_layout}}: This section presents the $\mu$DLX instruction layout and specifications. 
    \item Section \color{black}{\ref{sec:architecture_description}}: This section presents a description of each pipeline stage block, including pin definitions, signals and internal datapath.
	\end{itemize}
		
  \subsection{Acronyms and Abbreviations}
  Along this and other documents part of this project, it will be recurrent the usage of some acronyms and abbreviations. In order to keep track of this elements the Table \ref{tab:definitions} presents a set of abbreviations used and its corresponding meaning.
  
  \FloatBarrier
  \begin{table}[H]
    \begin{center}
      \caption{Acronym and descriptions of elements in this document.}
      \label{tab:definitions}

      \begin{tabular}[pos]{|m{2cm} | m{9cm}|} 
	\hline % este comando coloca uma linha na tabela
	\cellcolor[gray]{0.9}\textbf{Acronym} & \cellcolor[gray]{0.9}\textbf{Description} \\ \hline
	RISC & Reduced Instruction Set Computer \\ \hline
	GPR & General Purpose Registers \\ \hline
	FPGA & Field Gate Programmable Array \\ \hline
	GPPU & General Purpose Processing Unit \\ \hline
	SDRAM & Synchronous Dynamic Random Access Memory\\ \hline
	HDL & Hardware Description Language \\ \hline
	RAW & Read After Write \\ \hline
	CPU & Central Processing Unit \\ \hline
	ISA & Instruction Set Architecture \\ \hline
	ALU & Arithmetic and Logic Unit \\ \hline
	PC  & Program Counter \\ \hline
	RFlags & Flags Register \\ \hline
	Const  & Constant \\ \hline
  BPM    & Branch Prediction Buffer \\ \hline
      \end{tabular}
    \end{center}
  \end{table}
  
  \newpage
  \section{Architecture Overview}
  \label{sec:architecture_overview}
  
  \subsection{Interface Architecture}
  The $\mu$DLX architecture interface is composed by the following components.
  \begin{itemize}
    \item \textbf{$\mu$DLX 32-bit Core:} The core four-deep pipeline processor.
    \item \textbf{Memory Interface:} Provides a middle layer between the core processor and the external memories. This interface also controls the bootloader process.
    \item \textbf{SDRAM Controller:} Provides the interface for controlling the external SDRAM.
    \item \textbf{SRAM Controller:} Provides the interface for controlling the external SRAM.
  \end{itemize}
  \begin{figure}[H]
    \centering
    \includegraphics[width=.8\linewidth]{pictures/architecture_interface.eps}
  \end{figure}

  \subsection{Block Diagram}
  \begin{figure}[H]
    \centering
    \includegraphics[width=.85\linewidth]{pictures/udlx_block.eps}
  \end{figure}
 
 
  \subsection{Pin/Port Definitions}
  \FloatBarrier
  \begin{table}[H]
    \begin{center}
      \begin{tabular}[pos]{| l | c | c | m{7cm} |} \hline 	
      \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
	 clock 		& 1 	& input 	& CPU core clock  	\\ \hline
	 reset 		& 1	& input		& CPU core reset  	\\ \hline
	 instruction 	& 32	& input 	& SRAM instruction data \\ \hline
	 data\_read 	& 32	& input 	& SDRAM read data \\ \hline
	 instr\_addr 	& 20	& output 	& SRAM address \\ \hline
	 instr\_rd\_en 	& 1	& output 	& SRAM read enable  \\ \hline
	 data\_addr 	& 32	& output	& SDRAM address \\ \hline
	 data\_wr\_en 	& 1	& output 	& SDRAM write enable  \\ \hline
	 data\_rd\_en 	& 1	& output 	& SDRAM read enable  \\ \hline
   data\_write   & 32 & output  & SDRAM write data  \\ \hline
      \end{tabular}
    \end{center}
  \end{table}  


\begin{landscape}
  \subsection{Top Architecture \textcolor{red}{(Deprecated: \textit{needs a review})}}
    \begin{figure}[H]
      \centering
      \includegraphics[width=.7\linewidth]{pictures/top_architecture.eps}
    \end{figure}
  \end{landscape}

  
  %\subsection{Parameters and Configurations}

% \FloatBarrier
%  \begin{table}[H]
%    \begin{center}
%      \begin{tabular}[pos]{| l | l | m{8cm} |} \hline 	
%      \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
%      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Value}} & 
%      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
%	  & &  	\\ \hline
%      \end{tabular}
%    \end{center}
%  \end{table} 
    
  \newpage
  \section{Instructions Layout}
  In order to be the most close to the DLX and also be as compatible as possible to MIPS R2000 and R3000 architecture few instructions were added to the instruction set. Instructions that are not present in DLX and MIPS architecture are added in not used OPCODES.
  \label{sec:instruction_layout}

  \subsection{Instructions Set}
  DLX instruction structure has 5 types of instructions, the floating point instructions were removed. The 3 DLX instructions types supported in the project are shown in figure below.
  
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/instruction_set.eps}
  \end{figure} 
  
NOP instruction has zero in all bits and will not be mapped to an instruction type.
  
  \subsection{I-type Instruction}
  Immediate instructions use the immediate data to address a load and store operation, make arithmetic operations and make brachs using 
Some arithmetic immediate instructions were added because they make easier assembly programming. The conditional branch operations BEQZ and BNEQZ were added to enable some compiler compatibility and future core improvement.

  \FloatBarrier
  \begin{table}[H]
    \begin{center}
      \begin{tabular}[pos]{| c | l | l |} \hline 	
      \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{OPCODE}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Mneumonic}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Operation}} \\ \hline
	 100011/0x23 	& lw & $R_D = mem$ \\ \hline
	 101011/0x2b 	& sw & $mem = R_D$ \\ \hline
	 101010/0x2A 	& brfl & $TBD$ \\ \hline
	 001000/0x08 & addi & $R_D = R_S1 + Sext(imm)$ \\ \hline
	 001010/0x10 & subi & $R_D = R_S1 - Sext(imm)$ \\ \hline
	 001101/0x12 & andi & $R_D = R_S1 \land Sext(imm)$ \\ \hline
	 001101/0x13 & ori & $R_D = R_S1 \lor Sext(imm)$ \\ \hline
	 000100/0x04 & beqz & $PC = PC + 4 +(R_S1 = 0~?~SExt(imm): 0)$ \\ \hline
	 000101/0x05 & bnez & $Fixme$ \\ \hline
	 000111/0x16 & jr & $PC = R_S1$ \\ \hline
      \end{tabular}
    \end{center}
  \end{table} 

Only LW, SW, BRFL, and JR instructions are in the project requirements, the other were added to make compatibility and some codes easier.
  
  \subsection{R-type Instruction}
This instructions realize registers operations, most operations are arithmetic. All arithmetic opcodes are zero, differing only in the function value.

  \FloatBarrier
  \begin{table}[H]
    \begin{center}
      \begin{tabular}[pos]{| c | l | l |} \hline 	
      \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{OPCODE}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Mneumonic}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Operation}} \\ \hline
	 100000/0x20 	& add & $R_D = R_S1 + R_S2$ \\ \hline
	 100010/0x22 	& sub & $R_D = R_S1 - R_S2$ \\ \hline
	 100100/0x24 	& and & $R_D = R_S1 \land R_S2$ \\ \hline
	 100101/0x25 & or & $R_D = R_S1 \lor R_S2$ \\ \hline
	 011000/0x18 & mult & $R_D = R_S1 ~.~ R_S2$ \\ \hline
	 011010/0x1A & div & $R_D = R_S1 ~/~ R_S2$ \\ \hline
	 011100/0x1C & cmp & $R_D = R_S1 ~cmp~ R_S2$ \\ \hline
	 011101/0x1D & not & $R_D = \lnot R_S2$ \\ \hline

      \end{tabular}
    \end{center}
  \end{table} 

The MULT, DIV, CMP, and NOT instructions were added in DLX instruction set

  \subsection{J-type Instruction}
Instructions related with instruction memory jump. The instructions are JPC (J),RET (RFE), CALL (TRAP).
  \FloatBarrier
  \begin{table}[H]
    \begin{center}
      \begin{tabular}[pos]{| c | l | m{9cm} |} \hline 	
      \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{OPCODE}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Mneumonic}} & 
      \multicolumn{1}{m{9cm}|}{\cellcolor[gray]{0.9}\textbf{Operation}} \\ \hline
	 000010/0x02 	& jpc(j) & PC = PC + 4 \\ \hline
	 111110/0x3e 	& call(trap) & 
   trap = 1; \newline EPC = PC; \newline PC = SISR;
   \newline ESR = SR; \newline ECA = masked CA; \newline SR = 0; 
   \newline EDATA = SExt(imm); \newline Clear CA but catch new interrupt events \\ \hline
	 111111/0x3f 	& ret(rfe) & SR = ESR; \newline PC = EPC \\ \hline

      \end{tabular}
    \end{center}
  \end{table} 

%  \subsection{Control Transfer}
%  The $\mu$DLX core processor has five control transfer instructions encoded using the following three types. The first encoding type is used for unconditional jump and subroutine call. The second one is used for conditional branch, based on ALU flags. The third one reffers to the unconditional jump related to PC by an immediate value offset.
%
%  \hspace{-36px}\textbf{Type I}
%  \begin{figure}[H]
%    \centering
%    \includegraphics[width=\linewidth]{pictures/control_type_1.eps}
%  \end{figure}  
%  
%  \hspace{-36px}\textbf{Type II}
%  \begin{figure}[H]
%    \centering
%    \includegraphics[width=\linewidth]{pictures/control_type_2.eps}
%  \end{figure}  
%  
%  \hspace{-36px}\textbf{Type III}
%  \begin{figure}[H]
%    \centering
%    \includegraphics[width=\linewidth]{pictures/control_type_3.eps}
%  \end{figure}  
%  
%  \FloatBarrier
%  \begin{table}[H]
%    \begin{center}
%      \begin{tabular}[pos]{| c | l | l | l |} \hline 	
%      \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Type}} & 
%      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{OP}} & 
%      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Opperation}} &
%      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Mnemonic}} \\ \hline
%	 I 	& 00 & Jump Register	& jr r \\ \hline
%	 I 	& 01 & Subroutine call  & call r \\ \hline
%	 II 	& 10 & Branch flags 	& brfl r, const\\ \hline
%	 III 	& 11 & Jump PC 		& jpc destiny\\ \hline	 
%      \end{tabular}
%    \end{center}
%  \end{table}   
%  
%  \subsection{Memory}
%  \begin{figure}[H]
%    \centering
%    \includegraphics[width=\linewidth]{pictures/alu_instruction.eps}
%  \end{figure} 
%  
%  \FloatBarrier
%  \begin{table}[H]
%    \begin{center}
%      \begin{tabular}[pos]{| c | l | l |} \hline 	
%      \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{OP}} & 
%      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Opperation}} & 
%      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Mnemonic}} \\ \hline
%	 1000 & $R_D = Mem[R_B]$ 	& load d, b 	 \\ \hline
%	 1100 & $Mem[R_B] = R_D$ 	& store b, d 	\\ \hline
%      \end{tabular}
%    \end{center}
%  \end{table}   
  
  \section{Architecture Description}
  \label{sec:architecture_description}

  \subsection{Instruction Fetch}
  \subsubsection{Block Diagram}
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/blocks/if_block.eps}
  \end{figure}    
  
  \subsubsection{Pin/Port Definitions}
  \FloatBarrier
  \begin{table}[H]
    \begin{center}
      \begin{tabular}[pos]{| l | c | c | m{7cm} |} \hline 	
      \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
      \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
	 clock\_in 		          & 1 	& input 	& CPU core clock  	\\ \hline
	 reset\_in 		          & 1	  & input		& CPU core reset  	\\ \hline
	 inst\_mem\_data\_in     & TBD	& input 	& SRAM data \\ \hline
	 %branch\_pc 	      & 20	& input 	& Branch address PC relative \\ \hline
	 %branch\_reg 	      & 20	& input 	& Branch address loaded from registers \\ \hline
     select\_new\_pc\_in    & 1   & input   & Signal used for branch not taken \\ \hline
     new\_pc\_in    & 20   & input   & New value of PC \\ \hline
   
	 new\_pc\_out 		        & 20	& output 	& Updated value of PC \\ \hline
	 instruction\_reg\_out 	      & 32	& output 	& CPU core instruction  \\ \hline
	 inst\_mem\_addr\_out 	      & 20	& output	& SRAM address \\ \hline
      \end{tabular}
    \end{center}
  \end{table} 

  \subsubsection{Internal Datapath} 
  The internal data path is composed by the following components.

  \begin{description}
    \item [Program Counter]: During the instruction time of an instruction this is the
address of the instruction word. The address of the instruction that occurs during
the next instruction time is determined by assigning a value to PC during an instruction time. If no value is assigned to PC during an instruction time by any pseudocode statement, it is automatically incremented by 2 before the next
instruction time.

  \end{description}

  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/datapath/if_datapath.eps}
  \end{figure}   

  \newpage
  \subsection{Instruction Decode/Register Fetch}
  \subsubsection{Block Diagram}
  \begin{figure}[H]
    \centering
    \includegraphics[width=.8\linewidth]{pictures/blocks/id_block.eps}
  \end{figure} 
  
  \subsubsection{Pin/Port Definitions}
  \FloatBarrier
    \begin{center}
      \begin{longtable}[pos]{| l | c | c | m{7cm} |} \hline       	
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endfirsthead
        \hline
        \multicolumn{4}{|l|}%
        {{\bfseries continued from previous page}} \\
        \hline
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endhead

        \hline \multicolumn{4}{|r|}{{continued on next page}} \\ \hline
        \endfoot

        \hline
        \endlastfoot

      	clock\_in 		          & 1 	& input 	& CPU core clock  	\\ \hline
      	reset\_in 		          & 1	  & input		& CPU core reset  	\\ \hline
      	instruction\_reg\_in    & 32	& input 	& CPU core instruction \\ \hline
        wb\_write\_enable\_in   & 1   & input   & GPR write enable signal from WB    \\ \hline
      	wb\_write\_data\_in     & 32   & input  & GPR data to be writen   \\ \hline
        select\_new\_pc\_in     & 1   & input   & Stall and flush generation in jumps    \\ \hline
        id\_ex\_mem\_data\_rd\_en\_in & 1   & input   & Forwarding singal for hazzard control    \\ \hline
        id\_ex\_reg\_wr\_addr\_in & 6   & input   & Forwarding address for hazzard control    \\ \hline
        reg\_rd\_addr1\_out     & 5	  & output 	& Register file source address A \\ \hline
        reg\_rd\_addr2\_out     & 5   & output  & Register file source address B \\ \hline
      	opcode\_out 	          & 6	  & output 	& Instruction OpCode  \\ \hline
        inst\_function\_out     & 6   & output  & ALU function  \\ \hline
      	mem\_data\_rd\_en\_out  & 1   & output  & Data memory read enable  \\ \hline
        mem\_data\_wr\_en\_out 	& 1	  & output 	& Data memory write enable  \\ \hline
      	write\_back\_mux\_sel\_out 	& 1	& output	  & Write back mux selector \\ \hline
      	reg\_wr\_en\_out 	      & 1	  & output 	& GPR bank write enable signal  \\ \hline
      	reg\_addr\_out          & 5   & output  & GPR bank destiny address \\ \hline
        constant\_out 	        & 32  & output 	& 32-bit Sign-extended constant  \\ \hline
        imm\_inst\_out          & 1   & output  & TBD  \\ \hline
        data\_alu\_a\_out       & 32  & output  & ALU input A data \\ \hline
        data\_alu\_b\_out       & 32  & output  & ALU input B data \\ \hline
        new\_pc\_out            & 20  & output  & Updated value of PC delayed  \\ \hline
        pc\_offset\_out         & 26  & output  & TBD  \\ \hline
        branch\_inst\_out       & 1   & output  & Conditional branch instruction  \\ \hline
        jmp\_inst\_out          & 1   & output  & Incoditional branch instruction  \\ \hline
        jump\_use\_r\_out       & 1   & output  & TBD  \\ \hline  
        rd\_inst\_ena           & 1   & output  & TBD  \\ \hline  
        stall\_out              & 1   & output  & Insert a stall on the datapath  \\ \hline  
        general\_flush          & 1   & output  & Flush pipeline registers  \\ \hline  
      \end{longtable}
    \end{center}

  \newpage
  \subsubsection{Internal Datapath} 
  The internal data path is composed by the following components.

  \begin{figure}[H]
    \centering
    \includegraphics[width=0.45\linewidth]{pictures/datapath/id_datapath.eps}
  \end{figure} 
  
  
  \newpage
  \subsection{Execute/Address Calculate}
  \subsubsection{Block Diagram}
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/blocks/ex_block.eps}
  \end{figure} 

  \subsubsection{Pin/Port Definitions}
  \FloatBarrier
    \begin{center}
      \begin{longtable}[pos]{| l | c | c | m{7cm} |} \hline         
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endfirsthead
        \hline
        \multicolumn{4}{|l|}%
        {{\bfseries continued from previous page}} \\
        \hline
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endhead

        \hline \multicolumn{4}{|r|}{{continued on next page}} \\ \hline
        \endfoot

        \hline
        \endlastfoot

        clock\_in               & 1  & input  & CPU core clock    \\ \hline
        reset\_in               & 1  & input  & CPU core reset    \\ \hline
        alu\_opcode\_in         & 6  & input  & ALU opperation code  \\ \hline
        alu\_function\_in       & 6  & input  & Selects ALU function \\ \hline
        data\_alu\_a\_in        & 32 & input  & ALU input A data  \\ \hline
        data\_alu\_b\_in        & 32 & input  & ALU input B data  \\ \hline
        reg\_a\_addr\_in        & 5  & input  & ALU Port-A addr in Register File  \\ \hline
        reg\_b\_addr\_in        & 5  & input  & ALU Port-B addr in Register File  \\ \hline
        constant\_in            & 32 & input  & 32-bit constant  \\ \hline
        imm\_inst\_\_in         & 1  & input  & TBD \\ \hline  
        new\_pc\_in             & 20 & input  & Updated value of PC  \\ \hline 
        pc\_offset\_in          & 26 & input  & Constant offset in J-Instructions  \\ \hline 
        branch\_inst\_in        & 1  & input  & Branch instruction control signal \\ \hline        
        jmp\_inst\_in           & 1  & input  & Incoditional branch control signal \\ \hline        
        jmp\_use\_r\_in         & 1  & input  & TBD \\ \hline
        exe\_mem\_reg\_data\_in & 32 & input  & Forwarding data from the MEM stage data register \\ \hline
        exe\_mem\_reg\_addr\_in & 5  & input  & Forwarding address from the MEM stage \\ \hline
        exe\_mem\_reg\_wr\_ena\_in & 1 & input  & Forwarding write enable signal from the MEM stage \\ \hline        
        w\_reg\_data\_in        & 32  & input  & GPR bank data \\ \hline 
        w\_reg\_addr\_in        & 5   & input  & GPR bank destiny address \\ \hline 
        w\_reg\_wr\_en\_in      & 1   & input  & GPR bank write enable \\ \hline 
        instruction\_in         & 1   & input  & CPU core instruction \\ \hline
        
        mem\_data\_out          & 1   & output  & Forwarding output data to be writen in data memory \\ \hline
        alu\_data\_out          & 32  & output  & ALU output data \\ \hline
        fetch\_new\_pc\_out     & 32  & output  & TBD \\ \hline
        fetch\_select\_new\_pc\_out  & 32  & output  & TBD \\ \hline
      \end{longtable}
    \end{center} 
     
  \subsubsection{Internal Datapath} 
  The internal data path is composed by the following components.

  \begin{figure}[H]
    \centering
    \includegraphics[width=.8\linewidth]{pictures/datapath/ex_datapath.eps}
  \end{figure}  

  \newpage
  \subsection{Memory Access}
  \subsubsection{Block Diagram}
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/blocks/mem_block.eps}
  \end{figure} 

  \subsubsection{Pin/Port Definitions}
  \FloatBarrier
    \begin{center}
      \begin{longtable}[pos]{| l | c | c | m{7cm} |} \hline         
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endfirsthead
        \hline
        \multicolumn{4}{|l|}%
        {{\bfseries continued from previous page}} \\
        \hline
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endhead

        \hline \multicolumn{4}{|r|}{{continued on next page}} \\ \hline
        \endfoot

        \hline
        \endlastfoot

        clock\_in               & 1   & input  & CPU core clock    \\ \hline
        reset\_in               & 1   & input  & CPU core reset    \\ \hline
        write\_back\_mux\_sel\_in  & 1   & input  & Write back mux select \\ \hline        
        w\_reg\_wr\_en\_in        & 1   & input  & GPR bank write enable signal  \\ \hline        
        exe\_mem\_w\_reg\_addr         & TBD  & input  & GPR bank destiny address \\ \hline
        alu\_data\_in     & 32  & input  & ALU data output \\ \hline
        alu\_data\_out           & 32  & output  & ALU data output \\ \hline  
        write\_back\_mux\_sel\_out          & TBD & output  & Write back mux select \\ \hline                     
        mem\_wb\_w\_reg\_addr       & TBD & output & GPR bank destiny address \\ \hline

      \end{longtable}
    \end{center}  

  \subsubsection{Internal Datapath} 
  The internal data path is composed by the following components.

  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/datapath/mem_datapath.eps}
  \end{figure}    
  
  \newpage
  \subsection{Write Back}
  \subsubsection{Block Diagram}
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/blocks/wb_block.eps}
  \end{figure} 

  \subsubsection{Pin/Port Definitions}
  \FloatBarrier
    \begin{center}
      \begin{longtable}[pos]{| l | c | c | m{7cm} |} \hline         
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endfirsthead
        \hline
        \multicolumn{4}{|l|}%
        {{\bfseries continued from previous page}} \\
        \hline
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endhead

        \hline \multicolumn{4}{|r|}{{continued on next page}} \\ \hline
        \endfoot

        \hline
        \endlastfoot

        clock\_in               & 1   & input  & CPU core clock    \\ \hline
        reset\_in               & 1   & input  & CPU core reset    \\ \hline
        mem\_data\_in           & 32  & input  & SDRAM data output \\ \hline
        alu\_data\_in           & 32  & input  & ALU data output \\ \hline
        w\_reg\_en\_in      & 4   & input  & GPR bank write enable signal \\ \hline
        w\_reg\_addr\_in        & 1   & input  & GPR bank destiny address  \\ \hline
        write\_back\_mux\_sel  & TBD & input  & Write back mux select  \\ \hline
        w\_reg\_addr\_out        & 4   & output & GPR bank destiny address  \\ \hline
        reg\_data\_out           & 32  & output & GPR bank write data  \\ \hline
        w\_reg\_en\_out    & 1  & output  & GPR bank write enable signal  \\ \hline
      \end{longtable}
    \end{center}  

  \subsubsection{Internal Datapath} 
  The internal data path is composed by the following components.

  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/datapath/wb_datapath.eps}
  \end{figure}      
  
  \newpage
  \subsection{Pipeline Register Description}
  The following desciptions hightlights the datapath pipeline registers. For general purpose, the clock and reset signals was supressed. Althought, flush signal was also removed from IF/ID, ID/EX and EX/MEM pipeline registers.

  \subsubsection{Instruction Fetch/Instruction Decode}

  \FloatBarrier
    \begin{center}
      \begin{longtable}[pos]{| m{4cm} | c | m{7.5cm} |} \hline         
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endfirsthead
        \hline
        \multicolumn{3}{|l|}%
        {{\bfseries continued from previous page}} \\
        \hline
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endhead

        \hline \multicolumn{3}{|r|}{{continued on next page}} \\ \hline
        \endfoot

        \hline
        \endlastfoot
        clk               & 1   & CPU core clock    \\ \hline
        rst               & 1   & CPU core reset    \\ \hline
        stall             & 1   & Indicates a stall insertion on the datapath \\ \hline
        flush             & 1   & Force flush in pipeline registers \\ \hline
        pc                & 20  & Stores the next program counter value.\\ \hline
        inst\_mem\_data   & 32  & Stores the intruction word.    \\ \hline
      \end{longtable}
    \end{center} 

  \subsubsection{Instruction Decode/Execute}

  \FloatBarrier
    \begin{center}
      \begin{longtable}[pos]{| m{4cm} | c | m{7.5cm} |} \hline         
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endfirsthead
        \hline
        \multicolumn{3}{|l|}%
        {{\bfseries continued from previous page}} \\
        \hline
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endhead

        \hline \multicolumn{3}{|r|}{{continued on next page}} \\ \hline
        \endfoot

        \hline
        \endlastfoot
        clk                 & 1   & CPU core clock    \\ \hline
        rst                 & 1   & CPU core reset    \\ \hline
        flush               & 1   & Force flush in pipeline registers \\ \hline
        data\_alu\_a    & 32  & Stores the value of ALU input port A.  \\ \hline
        data\_alu\_b    & 32  & Stores the value of ALU input port B. \\ \hline
        new\_pc         & 20  & Stores the next program counter value.\\ \hline
        instruction     & 32  & Stores the intruction word.    \\ \hline        
        opcode              & 3   & Stores the instruction opperation code. \\ \hline
        inst\_function  & 6   & Stores ALU function  \\ \hline
        reg\_rd\_addr1  & 6   & Stores GPR source A address  \\ \hline
        reg\_rd\_addr2  & 6   & Stores GPR source B address  \\ \hline
        reg\_wr\_addr   & 6   & Stores GPR destination address  \\ \hline
        reg\_wr\_en     & 1   & Stores the signal to enable GPR write back. \\ \hline         
        constant        & 32  & Stores the signed extended integer constant. \\ \hline 
        immst       & 1   & TBD  \\ \hline
        pc\_offset      & 26  & Stores the PC offset in a J-Instruction \\ \hline
        mem\_data\_rd\_en & 1  & Stores read enable for data memory \\ \hline
        mem\_data\_rw\_en & 1  & Stores write enable for data memory \\ \hline
        write\_back\_mux\_sel  & 1 & Stores the select signal for write back mux. \\ \hline
        branchst    & 1   & TBD \\ \hline
        jump\_inst      & 1   & TBD \\ \hline
        jump\_use\_r    & 1   & TBD \\ \hline
      \end{longtable}
    \end{center} 

\subsubsection{Execute/Memory Access}

  \FloatBarrier
    \begin{center}
      \begin{longtable}[pos]{| m{4cm} | c | m{9cm} |} \hline         
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endfirsthead
        \hline
        \multicolumn{3}{|l|}%
        {{\bfseries continued from previous page}} \\
        \hline
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endhead

        \hline \multicolumn{3}{|r|}{{continued on next page}} \\ \hline
        \endfoot

        \hline
        \endlastfoot

        mem\_data\_rd\_en     & 1   & TBD \\ \hline
        mem\_data\_wr\_en     & 1   & TBD \\ \hline
        mem\_data             & 32  & TBD \\ \hline
        alu\_data             & 32  & Stores the output ALU Data \\ \hline
        reg\_wr\_en           & 1   & Stores the write register enable signal \\ \hline
        reg\_wr\_addr         & 5   & Stores the write register address \\ \hline
        write\_back\_mux\_sel & 1   & Stores the select signal for write back Multiplexer. \\ \hline
        select\_new\_pc       & 1   & TBD \\ \hline
        instruction           & 32  & Stores the intruction word.    \\ \hline
      \end{longtable}
    \end{center}  

\subsubsection{Memory Access/Write Back}

  \FloatBarrier
    \begin{center}
      \begin{longtable}[pos]{| m{3,5cm} | c | m{9cm} |} \hline         
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endfirsthead
        \hline
        \multicolumn{3}{|l|}%
        {{\bfseries continued from previous page}} \\
        \hline
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endhead

        \hline \multicolumn{3}{|r|}{{continued on next page}} \\ \hline
        \endfoot

        \hline
        \endlastfoot

        write\_back\_mux\_sel   & 1   & Stores the select signal for write back Multiplexer. \\ \hline
        alu\_data               & 32  & Stores the ALU output data. \\ \hline        
        reg\_wr\_en             & 1   & Stores the signal to enable GPR write back. \\ \hline
        reg\_wr\_addr           & 5   & Stores the GPR write address. \\ \hline
        instruction             & 32  & Stores the intruction word.    \\ \hline      

      \end{longtable}
    \end{center}   

\newpage
  \subsection{Memory and Device Interface}
The memory and device interface is responsible for memory mapping to the processor. Depending on the address accessed a specific memory will be accessed by the memory device interface. If it is a read operation in the next clock cycle the read data will be directed to the DLX input read data port.

  \begin{figure}[H]
    \centering
    \includegraphics[width=0.4\linewidth]{pictures/mem_dev_interface.eps}
  \end{figure} 

The memory map shown was created with separate address to show that devices have no relation between them and to show that the memory used in this project will be a small fraction for the 4GBytes possible.

\newpage
  \subsection{SRAM Controller}
  The SRAM will store the instructions, as the SRAM has only 16 bits of word and an instruction has 32 bits the read and write operation must be done in a faster clock domain to avoid stopping the microprocessor.  
  The SRAM has instruction code this way this memory is not written in normal operation. The SRAM will be written by the processor just during the bootloader code is running and during this operation no read will be done. Not having read and write simultaneously make easier the control not needing to deal with write and read operations at the same time.
    \subsubsection{Block Diagram}
  \begin{figure}[H]
    \centering
    \includegraphics[width=.8\linewidth]{pictures/blocks/sram_block.eps}
  \end{figure}  

  \subsubsection{Pin/Port Definitions}
  \FloatBarrier
    \begin{center}
      \begin{longtable}[pos]{| l | c | c | m{7cm} |} \hline         
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endfirsthead
        \hline
        \multicolumn{4}{|l|}%
        {{\bfseries continued from previous page}} \\
        \hline
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endhead

        \hline \multicolumn{4}{|r|}{{continued on next page}} \\ \hline
        \endfoot

        \hline
        \endlastfoot

        clk\_x2               & 1   & input  & SRAM clock that is twice the DLX clock    \\ \hline
        rst\_n               & 1   & input  & System asynchronous reset    \\ \hline
        wr\_en           & 1  & input  & Data write enable \\ \hline
        wr\_data           & 32  & input  & Data to be written in the memory \\ \hline
        address      & 24   & input  & Memory address from the DLX \\ \hline
        rd\_en        & 1   & input  & Data read enable  \\ \hline
        rd\_data  & 32 & output  & Read data from SRAM to the DLX \\ \hline
        sram\_rd\_en          & 1 & output  & TBD \\ \hline
        sram\_rd\_data        & 16   & output & TBD  \\ \hline
        sram\_addr           & 10  & output & Memory address that goes to the SRAM  \\ \hline
        sram\_wr\_en    & 1  & output  & TBD  \\ \hline
        sram\_wr\_data    & 16  & output  & TBD  \\ \hline
      \end{longtable}
    \end{center} 
     
As the SRAM has half word the controller works with a clock twice faster enabling read two address, concatenating and sending to the DLX in time.

\newpage
  \subsection{SDRAM Controller}
  The SDRAM controller will be very simple and optimized to read or write one word that will be requested by the processor. There will be no burst, just one word write or read operation.
    \subsubsection{Block Diagram}
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/blocks/sdram_block.eps}
  \end{figure}  

  \subsubsection{Pin/Port Definitions}
  \FloatBarrier
    \begin{center}
      \begin{longtable}[pos]{| l | c | c | m{7cm} |} \hline         
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endfirsthead
        \hline
        \multicolumn{4}{|l|}%
        {{\bfseries continued from previous page}} \\
        \hline
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endhead

        \hline \multicolumn{4}{|r|}{{continued on next page}} \\ \hline
        \endfoot

        \hline
        \endlastfoot

        clk               & 1   & input  & SDRAM controller input clock. 6 times faster than DLX clock    \\ \hline
        rst\_n               & 1   & input  & System asynchronous reset    \\ \hline
        wr\_en           & 1  & input  & Data write enable \\ \hline
        wr\_data\_in           & 32  & input  & Data to be written in the memory \\ \hline
        address      & 24   & input  & Address of write or read operation \\ \hline
        rd\_en        & 1   & input  & Data read enable  \\ \hline
        rd\_data  & 32 & output  & Data read from the SDRAM to the memory interface \\ \hline
        sdram\_addr          & 12 & output  & SDRAM data address \\ \hline
        sdram\_bank        & 2   & output & The SDRAM selected Bank  \\ \hline
        sdram\_cas\_n           & 1  & output & SDRAM CAS  \\ \hline
        sdram\_cs\_n    & 1  & output  & SDRAM chip select  \\ \hline
        sdram\_dq    & 32  & output  & SDRAM read data, 2 bus of 16 bits, one for each memory  \\ \hline
        sdram\_ldqm    & 1  & output  & TBD  \\ \hline
        sdram\_udqm    & 1  & output  & TBD  \\ \hline
        sdram\_ras\_n    & 1  & output  & SRAM RAS  \\ \hline
        sdram\_we\_n    & 1  & output  & SDRAM write enable  \\ \hline
      \end{longtable}
    \end{center} 

% \newpage
%   \subsection{Forwarding Unit}
%   TBD in further releases.

\newpage  
  \subsection{Control Micro-instructions Description}
     \subsubsection{Block Diagram}
  \begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{pictures/blocks/control_block.eps}
  \end{figure}  
  
    \subsubsection{Pin/Port Definitions}
  \FloatBarrier
    \begin{center}
      \begin{longtable}[pos]{| l | c | c | m{7cm} |} \hline         
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endfirsthead
        \hline
        \multicolumn{4}{|l|}%
        {{\bfseries continued from previous page}} \\
        \hline
        \multicolumn{1}{|c|}{\cellcolor[gray]{0.9}\textbf{Name}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Length}} & 
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Direction}} &
        \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        \endhead

        \hline \multicolumn{4}{|r|}{{continued on next page}} \\ \hline
        \endfoot

        \hline
        \endlastfoot
        
        instruction\_decoded               & 1   & input  & TBD    \\ \hline
        alu\_src\_out\_n               & 1   & output  & TBD    \\ \hline
        alu\_opcode\_out           & 1  & output  & TBD \\ \hline
        mem\_data\_wr\_en\_out           & 1  & output  & TBD \\ \hline
        write\_back\_mux\_sel\_out      & 1   & output  & TBD \\ \hline
        w\_reg\_wr\_en\_out        & 1   & output  & TBD  \\ \hline
        w\_reg\_addr\_out  & 1 & output  & TBD \\ \hline
        branch\_inst\_out          & 12 & output  & TBD \\ \hline
        jmp\_inst\_out        & 1   & output & TBD  \\ \hline
        
      \end{longtable}
    \end{center} 
  
  \newpage
  \subsection{Bootloader}
  The bootloader is the ROM memory has the code responsible to initialize the processor and write the code that will be executed in the correct address and consequently each memory device.

  The ROM must have the DLX reset PC register address. When the system is reseted the processor will read instructions from the ROM address. The code inside the ROM will copy the instruction and data code from a static memory to the instruction memory SRAM and the data memory SDRAM.

  \begin{figure}[H]
    \centering
    \includegraphics[width=.7\linewidth]{pictures/bootloader.eps}
  \end{figure}  
  
  Usually data in code is read-only data and it is common in compiled C code. Probably there will be only instruction code to be loaded during bootloader operation.

  \newpage
  \begin{landscape}
  \section{Processor Control Signals}
      
  \begin{table}[htp]
    \begin{center}
      \begin{tabular}{|l|c|c|c|c|c|c|c|}
        \hline
        \multicolumn{ 1}{|c|}{\cellcolor[gray]{0.9}\textbf{Signal}} & 
        \multicolumn{ 1}{c|}{\cellcolor[gray]{0.9}\textbf{R-Type}} & 
        \multicolumn{ 5}{c|}{\cellcolor[gray]{0.9}\textbf{I-Type}} & 
        \multicolumn{ 1}{c|}{\cellcolor[gray]{0.9}\textbf{J-PC}} \\ \cline{ 3-7}
        \multicolumn{ 1}{|c|}{\cellcolor[gray]{0.9}} & 
        \multicolumn{ 1}{l|}{\cellcolor[gray]{0.9}} & 
        \cellcolor[gray]{0.9}\textbf{Arith.} & 
        \cellcolor[gray]{0.9}\textbf{Load} & 
        \cellcolor[gray]{0.9}\textbf{Store} & 
        \cellcolor[gray]{0.9}\textbf{Branch} & 
        \cellcolor[gray]{0.9}\textbf{J-R} & 
        \multicolumn{ 1}{c|}{\cellcolor[gray]{0.9}} \\ \hline
        inst\_function        & I[5:0]    & N/A       & N/A       & N/A       & N/A       & N/A       & N/A \\ \hline
        reg\_rd\_addr1        & I[25:21]  & I[25:21]  & I[25:21]  & I[25:21]  & I[25:21]  & I[25:21]  & 0 \\ \hline
        reg\_rd\_addr2        & I[20:16]  & 0         & 0         & I[20:16]  & 0         & 0         & 0 \\ \hline
        reg\_rd\_en1          & 1         & 1         & 1         & 1         & 1         & 1         & 0 \\ \hline
        reg\_rd\_en2          & 1         & 0         & 0         & 1         & 0         & 0         & 0 \\ \hline
        reg\_wr\_addr         & I[15:11]  & I[20:16]  & I[20:16]  & 0         & I[20:16]  & N/A       & 0 \\ \hline
        reg\_wr\_en           & 1         & 1         & 1         & 0         & 0         & 0         & 0 \\ \hline
        immediate             & 0         & I[15:0]   & I[15:0]   & I[15:0]   & I[15:0]   & N/A       & 0 \\ \hline
        imm\_inst             & 0         & 1         & 1         & 1         & 1         & 1         & 0 \\ \hline
        pc\_offset            & 0         & 0         & 0         & 0         & 0         & 0         & I[25:0] \\ \hline
        mem\_data\_rd\_en     & 0         & 0         & 1         & 0         & 0         & 0         & 0 \\ \hline
        mem\_data\_wr\_en     & 0         & 0         & 0         & 1         & 0         & 0         & 0 \\ \hline
        write\_back\_mux\_sel & 0         & 0         & 1         & 0         & 0         & 0         & 0 \\ \hline
        branch\_inst          & 0         & 0         & 0         & 0         & 1         & 0         & 0 \\ \hline
        jump\_inst            & 0         & 0         & 0         & 0         & 0         & 1         & 1 \\ \hline
        jump\_use\_r          & 0         & 0         & 0         & 0         & 0         & 1         & 0 \\ \hline
      \end{tabular}
    \end{center}
  \end{table}
 
  \end{landscape}
  
  \subsection{Signal Description}

  \begin{table}[htbp]
    \begin{center}
      \begin{tabular}{|l|l|}
        \hline
        \cellcolor[gray]{0.9}\textbf{Signal} & \multicolumn{1}{c|}{\cellcolor[gray]{0.9}\textbf{Description}} \\ \hline
        inst\_function & Instruction ALU function. \\ \hline
        reg\_rd\_addr1 & Register file read address of Port-A. \\ \hline
        reg\_rd\_addr2 & Register file read address of Port-B. \\ \hline
        reg\_rd\_en1 & Register file read enable of Port-A. \\ \hline
        reg\_rd\_en2 & Register file read enable of Port-B. \\ \hline
        reg\_wr\_addr & Register file write address. \\ \hline
        reg\_wr\_en & Register file write enable. \\ \hline
        immediate & Immediate halfword. \\ \hline
        imm\_inst & Indicates a Immediate instruction type. \\ \hline
        pc\_offset & Determines the PC offset lenght in a J-type instruction. \\ \hline
        mem\_data\_rd\_en & Data memory read enable. \\ \hline
        mem\_data\_wr\_en & Data memory write enable. \\ \hline
        write\_back\_mux\_sel & Write back mux control signal. \\ \hline
        branch\_inst & Indicates a branch instruction. \\ \hline
        jump\_inst & Indicates a jump instruction, either Jump-R or Jump-PC \\ \hline
        jump\_use\_r & Indicates a Jump-R instruction. \\ \hline
        \end{tabular}
    \end{center}
  \end{table}  
  %\newpage
  %\section{Timing}
    
% \bibliographystyle{ieeetr}
% \bibliography{ipprocess}

\end{document}
